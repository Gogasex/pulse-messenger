<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pulse Messenger</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body data-theme="dark">

  <!-- –≠–ö–†–ê–ù –í–•–û–î–ê -->
  <div id="login-screen" class="screen active">
    <div class="login-container">
      <div class="login-logo">
        <div class="logo-icon"><i class="fas fa-bolt"></i></div>
        <h1>Pulse</h1>
        <p>–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</p>
      </div>
      <form id="login-form" class="login-form">
        <div class="input-group">
          <i class="fas fa-user"></i>
          <input type="text" id="username-input" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required minlength="2" maxlength="20" autocomplete="off">
        </div>
        <div class="input-group">
          <i class="fas fa-id-card"></i>
          <input type="text" id="displayname-input" placeholder="–û—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" maxlength="30" autocomplete="off">
        </div>
        <button type="submit" class="btn-primary"><i class="fas fa-arrow-right"></i> –í–æ–π—Ç–∏ –≤ Pulse</button>
      </form>
      <div class="login-hints">
        <p>üí° <strong>Ctrl+K</strong> ‚Äî –ø–æ–∏—Å–∫ | <strong>Ctrl+B</strong> ‚Äî –∂–∏—Ä–Ω—ã–π | <strong>Ctrl+I</strong> ‚Äî –∫—É—Ä—Å–∏–≤</p>
      </div>
    </div>
  </div>

  <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
  <div id="main-screen" class="screen">
    <div class="app-container">

      <!-- –°–ê–ô–î–ë–ê–† -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo-small"><i class="fas fa-bolt"></i><span>Pulse</span></div>
          <div class="sidebar-header-btns">
            <button class="btn-icon" onclick="app.toggleTheme()" title="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É"><i class="fas fa-moon"></i></button>
            <button class="btn-icon" id="btn-new-group" title="–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É"><i class="fas fa-plus"></i></button>
          </div>
        </div>

        <div class="search-bar">
          <i class="fas fa-search"></i>
          <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π... (Ctrl+K)">
        </div>

        <div class="search-results" id="search-results" style="display:none">
          <div class="search-results-header">
            <span>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span>
            <button class="btn-icon btn-small" id="btn-close-search"><i class="fas fa-times"></i></button>
          </div>
          <div class="search-results-list" id="search-results-list"></div>
        </div>

        <div class="chat-list" id="chat-list"></div>

        <div class="sidebar-footer">
          <div class="user-profile" onclick="app.showMyProfile()" style="cursor:pointer">
            <div class="avatar-small" id="my-avatar"><i class="fas fa-user"></i></div>
            <div class="user-info">
              <span class="username" id="my-name">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
              <span class="status-text" id="my-status">–í —Å–µ—Ç–∏</span>
            </div>
          </div>
          <button class="btn-icon" onclick="app.showMyProfile()" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏"><i class="fas fa-cog"></i></button>
        </div>
      </aside>

      <!-- –û–ë–õ–ê–°–¢–¨ –ß–ê–¢–ê -->
      <main class="chat-area">
        <header class="chat-header">
          <div class="chat-info">
            <button class="btn-icon mobile-back-btn" onclick="app.toggleSidebar()" title="–ù–∞–∑–∞–¥"><i class="fas fa-arrow-left"></i></button>
            <div class="avatar-medium"><i class="fas fa-comments"></i></div>
            <div>
              <h3 id="chat-name">üí¨ –û–±—â–∏–π —á–∞—Ç</h3>
              <span class="chat-subtitle" id="chat-subtitle">–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</span>
            </div>
          </div>
          <div class="chat-actions">
            <button class="btn-icon" onclick="app.showPollModal()" title="–û–ø—Ä–æ—Å"><i class="fas fa-poll"></i></button>
            <button class="btn-icon" onclick="app.showGamesMenu()" title="–ò–≥—Ä—ã"><i class="fas fa-gamepad"></i></button>
            <button class="btn-icon" onclick="app.showStats()" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"><i class="fas fa-chart-bar"></i></button>
            <button class="btn-icon" onclick="app.getInviteLink()" title="–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å"><i class="fas fa-link"></i></button>
            <button class="btn-icon" onclick="app.clearChat()" title="–û—á–∏—Å—Ç–∏—Ç—å"><i class="fas fa-broom"></i></button>
            <button class="btn-icon btn-danger" onclick="app.deleteRoom()" title="–£–¥–∞–ª–∏—Ç—å"><i class="fas fa-trash"></i></button>
          </div>
        </header>

        <!-- –ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω–æ–µ -->
        <div class="pinned-bar" id="pinned-bar" style="display:none">
          <i class="fas fa-thumbtack"></i>
          <div class="pinned-info">
            <span class="pinned-sender" id="pinned-sender"></span>
            <span class="pinned-text" id="pinned-text"></span>
          </div>
        </div>

        <div class="messages-container" id="messages-container">
          <div class="messages-list" id="messages-list"></div>
        </div>

        <div class="typing-indicator" id="typing-indicator" style="display:none">
          <div class="typing-dots"><span></span><span></span><span></span></div>
          <span class="typing-text" id="typing-text">–ø–µ—á–∞—Ç–∞–µ—Ç...</span>
        </div>

        <footer class="message-input-area">
          <div class="reply-preview" id="reply-preview" style="display:none">
            <div class="reply-content"><i class="fas fa-reply"></i><span id="reply-text"></span></div>
            <button class="btn-icon btn-small" id="btn-cancel-reply"><i class="fas fa-times"></i></button>
          </div>

          <div class="input-row">
            <button class="btn-icon" id="btn-attach" title="–§–∞–π–ª"><i class="fas fa-paperclip"></i></button>
            <input type="file" id="file-input" hidden>
            <button class="btn-icon" id="btn-voice" title="–ì–æ–ª–æ—Å–æ–≤–æ–µ"><i class="fas fa-microphone"></i></button>

            <div class="message-input-wrapper">
              <textarea id="message-input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ... (**–∂–∏—Ä–Ω—ã–π** *–∫—É—Ä—Å–∏–≤* `–∫–æ–¥`)" rows="1" maxlength="5000"></textarea>
            </div>

            <div class="voice-recording" id="voice-recording" style="display:none">
              <div class="recording-dot"></div>
              <span class="recording-time" id="recording-time">0:00</span>
              <button class="btn-icon btn-danger" id="btn-cancel-voice" title="–û—Ç–º–µ–Ω–∞"><i class="fas fa-times"></i></button>
              <button class="btn-icon btn-success" id="btn-send-voice" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å"><i class="fas fa-check"></i></button>
            </div>

            <!-- –ò—Å—á–µ–∑–∞—é—â–∏–µ -->
            <select id="expire-select" class="expire-select" title="–ò—Å—á–µ–∑–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
              <option value="0">üí¨</option>
              <option value="1">1–º</option>
              <option value="5">5–º</option>
              <option value="30">30–º</option>
              <option value="60">1—á</option>
              <option value="1440">24—á</option>
            </select>

            <div class="sound-selector">
              <button class="btn-icon btn-sound" id="btn-sound" title="–ó–≤—É–∫"><i class="fas fa-music"></i></button>
              <div class="sound-dropdown" id="sound-dropdown">
                <div class="sound-dropdown-header"><i class="fas fa-music"></i> –ó–≤—É–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏</div>
                <div class="sound-option active" data-sound="default"><i class="fas fa-bell"></i><span>–û–±—ã—á–Ω—ã–π</span><button class="btn-play" data-sound="default"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="birthday"><i class="fas fa-birthday-cake"></i><span>–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è üéÇ</span><button class="btn-play" data-sound="birthday"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="funny"><i class="fas fa-laugh-squint"></i><span>–°–º–µ—à–Ω–æ–π üòÇ</span><button class="btn-play" data-sound="funny"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="urgent"><i class="fas fa-exclamation-triangle"></i><span>–°—Ä–æ—á–Ω–æ! üö®</span><button class="btn-play" data-sound="urgent"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="romantic"><i class="fas fa-heart"></i><span>–†–æ–º–∞–Ω—Ç–∏–∫–∞ ‚ù§Ô∏è</span><button class="btn-play" data-sound="romantic"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="applause"><i class="fas fa-hands-clapping"></i><span>–ê–ø–ª–æ–¥–∏—Å–º–µ–Ω—Ç—ã üëè</span><button class="btn-play" data-sound="applause"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="victory"><i class="fas fa-trophy"></i><span>–ü–æ–±–µ–¥–∞ üèÜ</span><button class="btn-play" data-sound="victory"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="magic"><i class="fas fa-wand-magic-sparkles"></i><span>–ú–∞–≥–∏—è ‚ú®</span><button class="btn-play" data-sound="magic"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="scary"><i class="fas fa-ghost"></i><span>–°—Ç—Ä–∞—à–Ω—ã–π üëª</span><button class="btn-play" data-sound="scary"><i class="fas fa-play"></i></button></div>
                <div class="sound-option" data-sound="none"><i class="fas fa-volume-mute"></i><span>–ë–µ–∑ –∑–≤—É–∫–∞ üîá</span><button class="btn-play" data-sound="none"><i class="fas fa-play"></i></button></div>
              </div>
            </div>

            <button class="btn-icon" id="btn-emoji" title="–≠–º–æ–¥–∑–∏"><i class="fas fa-smile"></i></button>
            <div class="emoji-picker" id="emoji-picker" style="display:none"><div class="emoji-grid"></div></div>

            <button class="btn-send" id="btn-send" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å"><i class="fas fa-paper-plane"></i></button>
          </div>
        </footer>
      </main>

      <!-- –ü–ê–ù–ï–õ–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô -->
      <aside class="users-panel" id="users-panel">
        <div class="panel-header"><h3>üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏</h3></div>
        <div class="users-list" id="users-list"></div>
      </aside>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –ì–†–£–ü–ü–´ -->
  <div class="modal" id="modal-new-group" style="display:none">
    <div class="modal-content">
      <div class="modal-header"><h3><i class="fas fa-users"></i> –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞</h3><button class="btn-icon" id="btn-close-modal"><i class="fas fa-times"></i></button></div>
      <div class="modal-body">
        <div class="input-group"><i class="fas fa-edit"></i><input type="text" id="group-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"></div>
        <div class="input-group"><i class="fas fa-align-left"></i><input type="text" id="group-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></div>
        <label class="checkbox-label"><input type="checkbox" id="group-secret"> üîí –°–µ–∫—Ä–µ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ (–≤—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é)</label>
        <div class="input-group" id="group-password-wrap" style="display:none"><i class="fas fa-lock"></i><input type="text" id="group-password" placeholder="–ü–∞—Ä–æ–ª—å –≥—Ä—É–ø–ø—ã"></div>
        <p class="modal-hint">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</p>
        <div class="members-select" id="members-select"></div>
      </div>
      <div class="modal-footer"><button class="btn-secondary" id="btn-cancel-group">–û—Ç–º–µ–Ω–∞</button><button class="btn-primary" id="btn-create-group">–°–æ–∑–¥–∞—Ç—å</button></div>
    </div>
  </div>

  <!-- –ú–û–î–ê–õ–ö–ê –ü–†–û–§–ò–õ–Ø -->
  <div class="modal" id="modal-profile" style="display:none">
    <div class="modal-content modal-profile-large">
      <div class="modal-header"><h3><i class="fas fa-user-circle"></i> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3><button class="btn-icon" onclick="document.getElementById('modal-profile').style.display='none'"><i class="fas fa-times"></i></button></div>
      <div class="modal-body profile-modal-body">
        <div class="profile-avatar-large" id="profile-avatar-large">A</div>
        <input type="file" id="avatar-file-input" accept="image/*" hidden>

        <p class="section-label">–¶–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∫–∏</p>
        <div class="profile-color-picker">
          <span class="color-dot" style="background:#6c5ce7" onclick="app.setAvatarColor('#6c5ce7')"></span>
          <span class="color-dot" style="background:#00cec9" onclick="app.setAvatarColor('#00cec9')"></span>
          <span class="color-dot" style="background:#e17055" onclick="app.setAvatarColor('#e17055')"></span>
          <span class="color-dot" style="background:#00b894" onclick="app.setAvatarColor('#00b894')"></span>
          <span class="color-dot" style="background:#fdcb6e" onclick="app.setAvatarColor('#fdcb6e')"></span>
          <span class="color-dot" style="background:#ff7675" onclick="app.setAvatarColor('#ff7675')"></span>
          <span class="color-dot" style="background:#a29bfe" onclick="app.setAvatarColor('#a29bfe')"></span>
          <span class="color-dot" style="background:#fd79a8" onclick="app.setAvatarColor('#fd79a8')"></span>
          <span class="color-dot" style="background:#74b9ff" onclick="app.setAvatarColor('#74b9ff')"></span>
          <span class="color-dot" style="background:#55efc4" onclick="app.setAvatarColor('#55efc4')"></span>
          <span class="color-dot" style="background:#fab1a0" onclick="app.setAvatarColor('#fab1a0')"></span>
          <span class="color-dot" style="background:#636e72" onclick="app.setAvatarColor('#636e72')"></span>
        </div>

        <p class="section-label">–ê–≤–∞—Ç–∞—Ä–∫–∞</p>
        <div class="avatar-emoji-grid" id="avatar-emoji-grid"></div>

        <div class="input-group"><i class="fas fa-user"></i><input type="text" id="profile-displayname" placeholder="–ò–º—è"></div>
        <div class="input-group"><i class="fas fa-comment"></i><input type="text" id="profile-status" placeholder="–°—Ç–∞—Ç—É—Å"></div>
        <div class="input-group"><i class="fas fa-info-circle"></i><input type="text" id="profile-bio" placeholder="–û —Å–µ–±–µ" maxlength="150"></div>

        <p class="section-label">–°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
        <div class="activity-picker" id="activity-picker"></div>

        <p class="section-label">–§–æ–Ω —á–∞—Ç–∞</p>
        <div class="bg-picker-grid" id="bg-picker-grid"></div>

        <p class="section-label">–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å</p>
        <div class="privacy-options">
          <label class="checkbox-label"><input type="checkbox" id="profile-invisible"> üëª –ù–µ–≤–∏–¥–∏–º–∫–∞ (—Å–∫—Ä—ã—Ç—å –æ–Ω–ª–∞–π–Ω)</label>
          <label class="checkbox-label"><input type="checkbox" id="profile-dnd"> üîï –ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å</label>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="document.getElementById('modal-profile').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn-primary" onclick="app.saveProfile()"><i class="fas fa-check"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
  <div class="sound-notification" id="sound-notification" style="display:none">
    <div class="sound-notif-content"><i class="fas fa-bell"></i><span id="sound-notif-text"></span></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.min.js"></script>
  <script src="app.js"></script>
  <script>
    // –°–µ–∫—Ä–µ—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
    document.getElementById('group-secret')?.addEventListener('change', (e) => {
      document.getElementById('group-password-wrap').style.display = e.target.checked ? 'block' : 'none';
    });
  </script>
</body>
</html>